<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>

  <!-- VENDOR CSS -->
  <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/stylesheets/jquery-ui.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="/javascripts/jquery.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>
  <script src="/javascripts/jquery-ui.js"></script>
  <!-- MAIN CSS 
  <link rel="stylesheet" href="/stylesheets/main.css">
  -->

  <link rel='stylesheet' href='/stylesheets/style.css' />
  <!--<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">-->
  <!-- ICONS -->
</head>
<% include ./utility %>

  <body>
    <div class="table-title" style="margin:-4px 0px 10px; background:#0175d8;">
      <div class="row">
        <div class="col-sm-6">
          <h2>Welcome!!
            <b><%= admin.username %></b>
          </h2>
        </div>
        <div class="col-sm-6">
          <a href="/auth/logout" class="btn btn-warning">
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="table-wrapper">
        <div class="table-title">
          <div class="row">
            <div class="col-sm-6">
              <h2>Manage
                <b>Users</b>
              </h2>
            </div>
            <div class="col-sm-6">
              <a href="#addUserModal" class="btn btn-success" data-toggle="modal">
                <i class="material-icons"></i>
                <span>Add New User</span>
              </a>
              <!--<a href="#deleteUserModal" class="btn btn-danger" data-toggle="modal"><i class="material-icons"></i> <span>Delete</span></a>-->
            </div>
          </div>
        </div>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Id</th>
              <th>Name</th>
              <th>Birthday</th>
              <th>Sex</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% dataList.forEach(function(item) {%>
              <tr>
                <td class="column-id">
                  <%= item.id %>
                </td>
                <td class="column-name">
                  <%= item.name %>
                </td>
                <td class="column-birthday">
                  <%= getDateTime(item.birthday) %>
                </td>
                <td class="column-sex">
                  <%= BooleanToSexStr(item.sex) %>
                </td>
                <td>
                  <a href="#editUserModal" class="edit" data-toggle="modal">
                    <i class="material-icons" data-toggle="tooltip" title="Edit" data-original-title="Edit"></i>
                  </a>
                  <a href="#deleteUserModal" class="delete" data-toggle="modal">
                    <i class="material-icons" data-toggle="tooltip" title="Delete" data-original-title="Delete"></i>
                  </a>
                </td>
              </tr>
              <% }); %>
          </tbody>
        </table>
      </div>
    </div>
    <div id="addUserModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="api/users" method="post">
            <div class="modal-header">
              <h4 class="modal-title">Add User</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label>Name</label>
                <input name="name" type="text" class="form-control" required>
              </div>
              <div class="form-group">
                <label>Birthday</label>
                <input name="birthday" type="text" class="form-control datepicker" required onkeydown="return false;" autocomplete="off">
              </div>
              <div class="form-group">
                <label>Sex</label>
                </br>
                <select name="sex">
                  <option value="1">Male</option>
                  <option value="0">Female</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
              <input type="submit" class="btn btn-success" value="Add">
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Edit Modal HTML -->
    <div id="editUserModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="editUserForm" action="api/user/:id" method="post">
            <input type="hidden" name="_method" value="PUT">
            <div class="modal-header">
              <h4 class="modal-title">Edit User</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label>Name</label>
                <input type="text" name="name" class="form-control" required>
              </div>
              <div class="form-group">
                <label>Birthday</label>
                <input type="text" name="birthday" class="form-control datepicker" required onkeydown="return false;" autocomplete="off">
              </div>
              <div class="form-group">
                <label>Sex</label>
                </br>
                <select name="sex">
                  <option value="1">Male</option>
                  <option value="0">Female</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
              <input type="submit" class="btn btn-info" value="Update">
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Delete Modal HTML -->
    <div id="deleteUserModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="deleteUserForm" action="api/delete/user/:id" method="get">
            <div class="modal-header">
              <h4 class="modal-title">Delete User</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to delete this user?</p>
            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
              <input type="submit" class="btn btn-danger" value="Delete">
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>

  <script>
    $(function () {
      function TodateTime() {
        (new Date()).toISOString().substring(0, 19).replace('T', ' ');
      }

      function StrToSexualValue(s) {
        return (s === "Male") ? 1 : 0;
      }

      $(".datepicker").datepicker({ dateFormat: 'yy-mm-dd' });

      $('a[href$="#editUserModal"]').click(function () {
        var $row = $(this).closest("tr");
        var $modal = $("#editUserModal");
        var sex = StrToSexualValue($row.find(".column-sex").text().trim());
        $('#editUserForm').attr('action', "api/user/" + $row.find(".column-id").text().trim());
        $modal.find("input[name$='name']:first").val($row.find(".column-name").text().trim());
        $modal.find("input[name$='birthday']:first").val($row.find(".column-birthday").text().trim());
        $modal.find("select[name$='sex']:first").val(sex).change();
      });

      $('a[href$="#deleteUserModal"]').click(function () {
        var $row = $(this).closest("tr");
        $('#deleteUserForm').attr('action', "api/delete/user/" + $row.find(".column-id").text().trim());
      });

    });
  </script>

</html>